local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Mouse = LocalPlayer:GetMouse()

-- Globale Variablen
local VyrxisGui = nil
local MainFrame = nil
local MainRahmen = nil
local SettingsFrame = nil
local Liste = nil
local currentCategoryFrame = nil
local loadScreenShown = false

-- Settings
local settings = {
    menuKey = Enum.KeyCode.Insert,
    flyEnabled = false,
    flySpeed = 50,
    walkSpeed = 16,
    jumpHeight = 50,
    noclipEnabled = false,
    espEnabled = false,
    espColor = Color3.fromRGB(0, 255, 255),
    espTransparency = 0.3,
    nametagsEnabled = false,
    nametagColor = Color3.fromRGB(255, 255, 255),
    nametagSize = 20,
    selectedPlayer = nil
}

-- States
local flyConnection = nil
local noclipConnection = nil
local espObjects = {}
local nametagObjects = {}
local viewConnection = nil
local viewingPlayer = false

-- Design Constants - Professional Dark Theme
local COLORS = {
    BACKGROUND = Color3.fromRGB(20, 22, 28),
    SURFACE = Color3.fromRGB(32, 35, 42),
    SURFACE_LIGHT = Color3.fromRGB(45, 48, 55),
    SURFACE_HOVER = Color3.fromRGB(55, 58, 65),
    PRIMARY = Color3.fromRGB(0, 255, 255),
    PRIMARY_DARK = Color3.fromRGB(0, 200, 200),
    SUCCESS = Color3.fromRGB(34, 197, 94),
    DANGER = Color3.fromRGB(239, 68, 68),
    WARNING = Color3.fromRGB(245, 158, 11),
    TEXT_PRIMARY = Color3.fromRGB(255, 255, 255),
    TEXT_SECONDARY = Color3.fromRGB(156, 163, 175),
    TEXT_MUTED = Color3.fromRGB(107, 114, 128),
    ACCENT = Color3.fromRGB(0, 255, 255),
    BORDER = Color3.fromRGB(75, 85, 99),
    SHADOW = Color3.fromRGB(0, 0, 0)
}

-- Utility Functions
local function createTween(object, info, properties)
    local tween = TweenService:Create(object, info, properties)
    tween:Play()
    return tween
end

local function round(num, places)
    local mult = 10^(places or 0)
    return math.floor(num * mult + 0.5) / mult
end

local function createCorner(parent, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 12)
    corner.Parent = parent
    return corner
end

local function createStroke(parent, color, thickness)
    local stroke = Instance.new("UIStroke")
    stroke.Color = color or COLORS.BORDER
    stroke.Thickness = thickness or 1
    stroke.Transparency = 0.3
    stroke.Parent = parent
    return stroke
end

local function createGradient(parent, color1, color2, rotation)
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, color1 or COLORS.SURFACE),
        ColorSequenceKeypoint.new(1, color2 or COLORS.SURFACE_LIGHT)
    })
    gradient.Rotation = rotation or 90
    gradient.Parent = parent
    return gradient
end

local function createShadow(parent, intensity)
    local shadow = Instance.new("ImageLabel")
    shadow.Name = "DropShadow"
    shadow.Size = UDim2.new(1, 30, 1, 30)
    shadow.Position = UDim2.new(0, -15, 0, -15)
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxasset://textures/ui/Controls/DropShadow.png"
    shadow.ImageColor3 = COLORS.SHADOW
    shadow.ImageTransparency = intensity or 0.5
    shadow.ZIndex = parent.ZIndex - 1
    shadow.Parent = parent.Parent
    return shadow
end

-- Professional Load Screen
local function createLoadScreen()
    if loadScreenShown then return end
    loadScreenShown = true
    
    local loadGui = Instance.new("ScreenGui")
    loadGui.Name = "VyrxisLoadScreen"
    loadGui.Parent = PlayerGui
    loadGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Full transparent background
    local loadFrame = Instance.new("Frame")
    loadFrame.Size = UDim2.new(1, 0, 1, 0)
    loadFrame.Position = UDim2.new(0, 0, 0, 0)
    loadFrame.BackgroundTransparency = 1
    loadFrame.Parent = loadGui
    
    -- Load container with modern design
    local loadContainer = Instance.new("Frame")
    loadContainer.Size = UDim2.new(0, 400, 0, 250)
    loadContainer.Position = UDim2.new(0.5, -200, 0.5, -125)
    loadContainer.BackgroundColor3 = COLORS.BACKGROUND
    loadContainer.BorderSizePixel = 0
    loadContainer.Parent = loadFrame
    
    createCorner(loadContainer, 16)
    createStroke(loadContainer, COLORS.ACCENT, 2)
    createShadow(loadContainer, 0.7)
    createGradient(loadContainer, COLORS.BACKGROUND, Color3.fromRGB(25, 28, 35))
    
    -- Logo with glow effect
    local logoFrame = Instance.new("Frame")
    logoFrame.Size = UDim2.new(1, -40, 0, 80)
    logoFrame.Position = UDim2.new(0, 20, 0, 30)
    logoFrame.BackgroundTransparency = 1
    logoFrame.Parent = loadContainer
    
    local logo = Instance.new("TextLabel")
    logo.Size = UDim2.new(1, 0, 1, 0)
    logo.BackgroundTransparency = 1
    logo.Text = "VYRXIS"
    logo.TextColor3 = COLORS.ACCENT
    logo.TextScaled = true
    logo.Font = Enum.Font.GothamBold
    logo.TextStrokeTransparency = 0
    logo.TextStrokeColor3 = Color3.fromRGB(0, 100, 100)
    logo.Parent = logoFrame
    
    -- Animated subtitle
    local subtitle = Instance.new("TextLabel")
    subtitle.Size = UDim2.new(1, -40, 0, 25)
    subtitle.Position = UDim2.new(0, 20, 0, 120)
    subtitle.BackgroundTransparency = 1
    subtitle.Text = "Advanced Game Enhancement Suite"
    subtitle.TextColor3 = COLORS.TEXT_SECONDARY
    subtitle.TextScaled = true
    subtitle.Font = Enum.Font.Gotham
    subtitle.Parent = loadContainer
    
    -- Status text
    local statusText = Instance.new("TextLabel")
    statusText.Size = UDim2.new(1, -40, 0, 20)
    statusText.Position = UDim2.new(0, 20, 0, 160)
    statusText.BackgroundTransparency = 1
    statusText.Text = "Vyrxis Menu Starting..."
    statusText.TextColor3 = COLORS.TEXT_MUTED
    statusText.TextScaled = true
    statusText.Font = Enum.Font.Gotham
    statusText.Parent = loadContainer
    
    -- Modern progress bar
    local progressBg = Instance.new("Frame")
    progressBg.Size = UDim2.new(1, -40, 0, 4)
    progressBg.Position = UDim2.new(0, 20, 0, 190)
    progressBg.BackgroundColor3 = COLORS.SURFACE
    progressBg.BorderSizePixel = 0
    progressBg.Parent = loadContainer
    createCorner(progressBg, 2)
    
    local progressBar = Instance.new("Frame")
    progressBar.Size = UDim2.new(0, 0, 1, 0)
    progressBar.BackgroundColor3 = COLORS.ACCENT
    progressBar.BorderSizePixel = 0
    progressBar.Parent = progressBg
    createCorner(progressBar, 2)
    createGradient(progressBar, COLORS.ACCENT, Color3.fromRGB(0, 200, 255))
    
    -- Türkise Randeffekte
    for i = 1, 8 do
        local particle = Instance.new("Frame")
        particle.Size = UDim2.new(0, math.random(6, 12), 0, math.random(6, 12))
        particle.BackgroundColor3 = COLORS.ACCENT
        particle.BackgroundTransparency = 0.3
        particle.BorderSizePixel = 0
        particle.Position = UDim2.new(
            math.random() > 0.5 and math.random(0, 10)/100 or math.random(90, 100)/100,
            0, 
            math.random(10, 90)/100, 
            0
        )
        particle.Parent = loadFrame
        createCorner(particle, math.random(3, 6))
        
        -- Floating animation
        spawn(function()
            while particle.Parent do
                createTween(particle, TweenInfo.new(
                    3 + math.random() * 2, 
                    Enum.EasingStyle.Sine, 
                    Enum.EasingDirection.InOut,
                    -1,
                    true
                ), {
                    Position = UDim2.new(
                        particle.Position.X.Scale + (math.random(-20, 20)/100),
                        0,
                        particle.Position.Y.Scale + (math.random(-10, 10)/100),
                        0
                    ),
                    BackgroundTransparency = 0.1 + math.random() * 0.7
                })
                wait(3 + math.random() * 2)
            end
        end)
    end
    
    -- Loading sequence
    spawn(function()
        local steps = {"Initializing", "Loading Assets", "Starting Systems", "Ready"}
        
        for i, step in ipairs(steps) do
            statusText.Text = step .. "..."
            createTween(progressBar, TweenInfo.new(1.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Size = UDim2.new(i / #steps, 0, 1, 0)
            })
            wait(1.2)
        end
        
        wait(0.5)
        statusText.Text = "Welcome to Vyrxis!"
        wait(0.8)
        
        -- Fade out animation
        createTween(loadContainer, TweenInfo.new(0.8, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        })
        
        for _, particle in ipairs(loadFrame:GetChildren()) do
            if particle.Name ~= "DropShadow" then
                createTween(particle, TweenInfo.new(0.8, Enum.EasingStyle.Quad), {
                    BackgroundTransparency = 1
                })
            end
        end
        
        wait(0.8)
        loadGui:Destroy()
    end)
end

-- Professional Main UI
local function createMainUI()
    VyrxisGui = Instance.new("ScreenGui")
    VyrxisGui.Name = "VyrxisMenu"
    VyrxisGui.Parent = PlayerGui
    VyrxisGui.ResetOnSpawn = false
    VyrxisGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    VyrxisGui.Enabled = true
    
    -- MainRahmen (Draggable Header)
    MainRahmen = Instance.new("Frame")
    MainRahmen.Name = "MainRahmen"
    MainRahmen.Size = UDim2.new(0, 900, 0, 60)
    MainRahmen.Position = UDim2.new(0.5, -450, 0.5, -300)
    MainRahmen.BackgroundColor3 = COLORS.SURFACE
    MainRahmen.BorderSizePixel = 0
    MainRahmen.ZIndex = 10
    MainRahmen.Parent = VyrxisGui
    
    createCorner(MainRahmen, 16)
    createStroke(MainRahmen, COLORS.ACCENT, 2)
    createShadow(MainRahmen, 0.6)
    createGradient(MainRahmen, COLORS.SURFACE, COLORS.SURFACE_LIGHT)
    
    -- Title section
    local titleFrame = Instance.new("Frame")
    titleFrame.Size = UDim2.new(0, 350, 1, 0)
    titleFrame.Position = UDim2.new(0, 20, 0, 0)
    titleFrame.BackgroundTransparency = 1
    titleFrame.Parent = MainRahmen
    
    local logoIcon = Instance.new("TextLabel")
    logoIcon.Size = UDim2.new(0, 40, 0, 40)
    logoIcon.Position = UDim2.new(0, 0, 0, 10)
    logoIcon.BackgroundTransparency = 1
    logoIcon.Text = "⚡"
    logoIcon.TextColor3 = COLORS.ACCENT
    logoIcon.TextScaled = true
    logoIcon.Font = Enum.Font.GothamBold
    logoIcon.TextStrokeTransparency = 0.5
    logoIcon.TextStrokeColor3 = Color3.fromRGB(0, 100, 100)
    logoIcon.Parent = titleFrame
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(0, 200, 0, 35)
    titleLabel.Position = UDim2.new(0, 50, 0, 5)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "Vyrxis Menu"
    titleLabel.TextColor3 = COLORS.TEXT_PRIMARY
    titleLabel.TextSize = 24
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleFrame
    
    local versionLabel = Instance.new("TextLabel")
    versionLabel.Size = UDim2.new(0, 100, 0, 18)
    versionLabel.Position = UDim2.new(0, 50, 0, 35)
    versionLabel.BackgroundTransparency = 1
    versionLabel.Text = "v3.0 Professional"
    versionLabel.TextColor3 = COLORS.TEXT_MUTED
    versionLabel.TextSize = 12
    versionLabel.Font = Enum.Font.Gotham
    versionLabel.TextXAlignment = Enum.TextXAlignment.Left
    versionLabel.Parent = titleFrame
    
    -- Control buttons
    local controlFrame = Instance.new("Frame")
    controlFrame.Size = UDim2.new(0, 180, 0, 40)
    controlFrame.Position = UDim2.new(1, -200, 0, 10)
    controlFrame.BackgroundTransparency = 1
    controlFrame.Parent = MainRahmen
    
    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Size = UDim2.new(0, 40, 0, 40)
    minimizeBtn.Position = UDim2.new(0, 0, 0, 0)
    minimizeBtn.BackgroundColor3 = COLORS.SURFACE_LIGHT
    minimizeBtn.Text = "−"
    minimizeBtn.TextColor3 = COLORS.TEXT_PRIMARY
    minimizeBtn.TextSize = 20
    minimizeBtn.Font = Enum.Font.GothamBold
    minimizeBtn.BorderSizePixel = 0
    minimizeBtn.AutoButtonColor = false
    minimizeBtn.Parent = controlFrame
    createCorner(minimizeBtn, 10)
    createStroke(minimizeBtn, COLORS.BORDER)
    createGradient(minimizeBtn, COLORS.SURFACE_LIGHT, COLORS.SURFACE_HOVER)
    
    local settingsBtn = Instance.new("TextButton")
    settingsBtn.Size = UDim2.new(0, 120, 0, 40)
    settingsBtn.Position = UDim2.new(0, 60, 0, 0)
    settingsBtn.BackgroundColor3 = COLORS.PRIMARY
    settingsBtn.Text = "Settings"
    settingsBtn.TextColor3 = COLORS.TEXT_PRIMARY
    settingsBtn.TextSize = 14
    settingsBtn.Font = Enum.Font.GothamSemibold
    settingsBtn.BorderSizePixel = 0
    settingsBtn.AutoButtonColor = false
    settingsBtn.Parent = controlFrame
    createCorner(settingsBtn, 10)
    createGradient(settingsBtn, COLORS.PRIMARY, COLORS.PRIMARY_DARK)
    
    -- MainFrame (Tablet-shaped content area)
    MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 900, 0, 520)
    MainFrame.Position = UDim2.new(0, 0, 1, 10)
    MainFrame.BackgroundColor3 = COLORS.BACKGROUND
    MainFrame.BorderSizePixel = 0
    MainFrame.ZIndex = 9
    MainFrame.Parent = MainRahmen
    
    createCorner(MainFrame, 16)
    createStroke(MainFrame, COLORS.BORDER)
    createShadow(MainFrame, 0.4)
    createGradient(MainFrame, COLORS.BACKGROUND, Color3.fromRGB(25, 28, 35))
    
    -- Sidebar (Categories Liste)
    Liste = Instance.new("ScrollingFrame")
    Liste.Name = "Liste"
    Liste.Size = UDim2.new(0, 220, 1, -40)
    Liste.Position = UDim2.new(0, 20, 0, 20)
    Liste.BackgroundColor3 = COLORS.SURFACE
    Liste.BorderSizePixel = 0
    Liste.ScrollBarThickness = 8
    Liste.ScrollBarImageColor3 = COLORS.ACCENT
    Liste.ScrollBarImageTransparency = 0.3
    Liste.CanvasSize = UDim2.new(0, 0, 0, 0)
    Liste.AutomaticCanvasSize = Enum.AutomaticSize.Y
    Liste.Parent = MainFrame
    
    createCorner(Liste, 12)
    createStroke(Liste, COLORS.BORDER)
    createGradient(Liste, COLORS.SURFACE, COLORS.SURFACE_LIGHT)
    
    local listeLayout = Instance.new("UIListLayout")
    listeLayout.Padding = UDim.new(0, 12)
    listeLayout.Parent = Liste
    
    local listePadding = Instance.new("UIPadding")
    listePadding.PaddingAll = UDim.new(0, 16)
    listePadding.Parent = Liste
    
    -- Content Area
    local contentArea = Instance.new("Frame")
    contentArea.Size = UDim2.new(0, 640, 1, -40)
    contentArea.Position = UDim2.new(0, 260, 0, 20)
    contentArea.BackgroundColor3 = COLORS.SURFACE
    contentArea.BorderSizePixel = 0
    contentArea.Parent = MainFrame
    
    createCorner(contentArea, 12)
    createStroke(contentArea, COLORS.BORDER)
    createGradient(contentArea, COLORS.SURFACE, COLORS.SURFACE_LIGHT)
    
    -- Welcome screen
    local welcomeFrame = Instance.new("Frame")
    welcomeFrame.Size = UDim2.new(1, -40, 1, -40)
    welcomeFrame.Position = UDim2.new(0, 20, 0, 20)
    welcomeFrame.BackgroundTransparency = 1
    welcomeFrame.Parent = contentArea
    
    local welcomeTitle = Instance.new("TextLabel")
    welcomeTitle.Size = UDim2.new(1, 0, 0, 60)
    welcomeTitle.Position = UDim2.new(0, 0, 0.3, 0)
    welcomeTitle.BackgroundTransparency = 1
    welcomeTitle.Text = "Welcome to Vyrxis"
    welcomeTitle.TextColor3 = COLORS.ACCENT
    welcomeTitle.TextSize = 32
    welcomeTitle.Font = Enum.Font.GothamBold
    welcomeTitle.Parent = welcomeFrame
    
    local welcomeSubtitle = Instance.new("TextLabel")
    welcomeSubtitle.Size = UDim2.new(1, 0, 0, 40)
    welcomeSubtitle.Position = UDim2.new(0, 0, 0.45, 0)
    welcomeSubtitle.BackgroundTransparency = 1
    welcomeSubtitle.Text = "Select a category to get started"
    welcomeSubtitle.TextColor3 = COLORS.TEXT_SECONDARY
    welcomeSubtitle.TextSize = 18
    welcomeSubtitle.Font = Enum.Font.Gotham
    welcomeSubtitle.Parent = welcomeFrame
    
    -- Button hover effects
    minimizeBtn.MouseEnter:Connect(function()
        createTween(minimizeBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.DANGER})
    end)
    minimizeBtn.MouseLeave:Connect(function()
        createTween(minimizeBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.SURFACE_LIGHT})
    end)
    
    settingsBtn.MouseEnter:Connect(function()
        createTween(settingsBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.PRIMARY_DARK})
    end)
    settingsBtn.MouseLeave:Connect(function()
        createTween(settingsBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.PRIMARY})
    end)
    
    -- Drag functionality
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    MainRahmen.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainRahmen.Position
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            MainRahmen.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    -- Minimize functionality
    minimizeBtn.MouseButton1Click:Connect(function()
        if MainFrame.Visible then
            createTween(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
                Size = UDim2.new(0, 900, 0, 0)
            })
            wait(0.4)
            MainFrame.Visible = false
        else
            MainFrame.Visible = true
            MainFrame.Size = UDim2.new(0, 900, 0, 0)
            createTween(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Size = UDim2.new(0, 900, 0, 520)
            })
        end
    end)
    
    -- Settings functionality
    settingsBtn.MouseButton1Click:Connect(function()
        if SettingsFrame then
            SettingsFrame.Visible = true
        end
    end)
    
    return contentArea
end

-- Professional Settings Frame
local function createSettingsFrame()
    SettingsFrame = Instance.new("Frame")
    SettingsFrame.Name = "SettingsFrame"
    SettingsFrame.Size = UDim2.new(0, 450, 0, 350)
    SettingsFrame.Position = UDim2.new(0.5, -225, 0.5, -175)
    SettingsFrame.BackgroundColor3 = COLORS.BACKGROUND
    SettingsFrame.BorderSizePixel = 0
    SettingsFrame.Visible = false
    SettingsFrame.ZIndex = 25
    SettingsFrame.Parent = VyrxisGui
    
    createCorner(SettingsFrame, 16)
    createStroke(SettingsFrame, COLORS.ACCENT, 2)
    createShadow(SettingsFrame, 0.8)
    createGradient(SettingsFrame, COLORS.BACKGROUND, Color3.fromRGB(28, 32, 40))
    
    -- Header
    local header = Instance.new("Frame")
    header.Size = UDim2.new(1, 0, 0, 70)
    header.BackgroundColor3 = COLORS.SURFACE
    header.BorderSizePixel = 0
    header.Parent = SettingsFrame
    createCorner(header, 16)
    createGradient(header, COLORS.SURFACE, COLORS.SURFACE_LIGHT)
    
    local headerTitle = Instance.new("TextLabel")
    headerTitle.Size = UDim2.new(1, -80, 1, 0)
    headerTitle.Position = UDim2.new(0, 25, 0, 0)
    headerTitle.BackgroundTransparency = 1
    headerTitle.Text = "Settings"
    headerTitle.TextColor3 = COLORS.TEXT_PRIMARY
    headerTitle.TextSize = 24
    headerTitle.Font = Enum.Font.GothamBold
    headerTitle.TextXAlignment = Enum.TextXAlignment.Left
    headerTitle.Parent = header
    
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 45, 0, 45)
    closeBtn.Position = UDim2.new(1, -60, 0, 12.5)
    closeBtn.BackgroundColor3 = COLORS.DANGER
    closeBtn.Text = "✕"
    closeBtn.TextColor3 = COLORS.TEXT_PRIMARY
    closeBtn.TextSize = 16
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.BorderSizePixel = 0
    closeBtn.AutoButtonColor = false
    closeBtn.Parent = header
    createCorner(closeBtn, 10)
    createGradient(closeBtn, COLORS.DANGER, Color3.fromRGB(200, 50, 50))
    
    -- Content area
    local content = Instance.new("Frame")
    content.Size = UDim2.new(1, -50, 1, -120)
    content.Position = UDim2.new(0, 25, 0, 90)
    content.BackgroundTransparency = 1
    content.Parent = SettingsFrame
    
    -- Keybind section
    local keybindFrame = Instance.new("Frame")
    keybindFrame.Size = UDim2.new(1, 0, 0, 80)
    keybindFrame.BackgroundColor3 = COLORS.SURFACE
    keybindFrame.BorderSizePixel = 0
    keybindFrame.Parent = content
    createCorner(keybindFrame, 12)
    createStroke(keybindFrame, COLORS.BORDER)
    createGradient(keybindFrame, COLORS.SURFACE, COLORS.SURFACE_LIGHT)
    
    local keybindPadding = Instance.new("UIPadding")
    keybindPadding.PaddingAll = UDim.new(0, 20)
    keybindPadding.Parent = keybindFrame
    
    local keybindLabel = Instance.new("TextLabel")
    keybindLabel.Size = UDim2.new(1, 0, 0, 25)
    keybindLabel.BackgroundTransparency = 1
    keybindLabel.Text = "Toggle Menu Key: " .. settings.menuKey.Name
    keybindLabel.TextColor3 = COLORS.TEXT_PRIMARY
    keybindLabel.TextSize = 16
    keybindLabel.Font = Enum.Font.GothamSemibold
    keybindLabel.TextXAlignment = Enum.TextXAlignment.Left
    keybindLabel.Parent = keybindFrame
    
    local keybindBtn = Instance.new("TextButton")
    keybindBtn.Size = UDim2.new(0, 180, 0, 35)
    keybindBtn.Position = UDim2.new(0, 0, 1, -35)
    keybindBtn.BackgroundColor3 = COLORS.PRIMARY
    keybindBtn.Text = "Change Key"
    keybindBtn.TextColor3 = COLORS.TEXT_PRIMARY
    keybindBtn.TextSize = 14
    keybindBtn.Font = Enum.Font.GothamSemibold
    keybindBtn.BorderSizePixel = 0
    keybindBtn.AutoButtonColor = false
    keybindBtn.Parent = keybindFrame
    createCorner(keybindBtn, 8)
    createGradient(keybindBtn, COLORS.PRIMARY, COLORS.PRIMARY_DARK)
    
    -- Button events
    closeBtn.MouseButton1Click:Connect(function()
        createTween(SettingsFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        })
        wait(0.3)
        SettingsFrame.Visible = false
        SettingsFrame.Size = UDim2.new(0, 450, 0, 350)
        SettingsFrame.Position = UDim2.new(0.5, -225, 0.5, -175)
    end)
    
    keybindBtn.MouseButton1Click:Connect(function()
        keybindBtn.Text = "Press any key..."
        keybindBtn.BackgroundColor3 = COLORS.WARNING
        local connection
        connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
            if not gameProcessed and input.UserInputType == Enum.UserInputType.Keyboard then
                settings.menuKey = input.KeyCode
                keybindLabel.Text = "Toggle Menu Key: " .. settings.menuKey.Name
                keybindBtn.Text = "Change Key"
                keybindBtn.BackgroundColor3 = COLORS.PRIMARY
                connection:Disconnect()
            end
        end)
    end)
    
    -- Hover effects
    closeBtn.MouseEnter:Connect(function()
        createTween(closeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 60, 60)})
    end)
    closeBtn.MouseLeave:Connect(function()
        createTween(closeBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.DANGER})
    end)
    
    keybindBtn.MouseEnter:Connect(function()
        createTween(keybindBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.PRIMARY_DARK})
    end)
    keybindBtn.MouseLeave:Connect(function()
        if keybindBtn.BackgroundColor3 ~= COLORS.WARNING then
            createTween(keybindBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.PRIMARY})
        end
    end)
end

-- Modern UI Elements
local function createModernButton(parent, text, callback, style, icon)
    style = style or "default"
    
    local btnFrame = Instance.new("Frame")
    btnFrame.Size = UDim2.new(1, -20, 0, 55)
    btnFrame.BackgroundTransparency = 1
    btnFrame.Parent = parent
    
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 1, 0)
    btn.BackgroundColor3 = style == "success" and COLORS.SUCCESS or 
                          style == "danger" and COLORS.DANGER or 
                          style == "primary" and COLORS.PRIMARY or
                          COLORS.SURFACE_LIGHT
    btn.Text = ""
    btn.BorderSizePixel = 0
    btn.AutoButtonColor = false
    btn.Parent = btnFrame
    
    createCorner(btn, 12)
    createStroke(btn, COLORS.BORDER)
    createGradient(btn, btn.BackgroundColor3, Color3.new(
        math.min(1, btn.BackgroundColor3.R + 0.1),
        math.min(1, btn.BackgroundColor3.G + 0.1),
        math.min(1, btn.BackgroundColor3.B + 0.1)
    ))
    
    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1, -30, 1, 0)
    contentFrame.Position = UDim2.new(0, 15, 0, 0)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = btn
    
    local iconLabel = nil
    if icon then
        iconLabel = Instance.new("TextLabel")
        iconLabel.Size = UDim2.new(0, 25, 0, 25)
        iconLabel.Position = UDim2.new(0, 0, 0, 15)
        iconLabel.BackgroundTransparency = 1
        iconLabel.Text = icon
        iconLabel.TextColor3 = COLORS.TEXT_PRIMARY
        iconLabel.TextSize = 18
        iconLabel.Font = Enum.Font.GothamBold
        iconLabel.Parent = contentFrame
    end
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, icon and -35 or -50, 1, 0)
    label.Position = UDim2.new(0, icon and 35 or 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = COLORS.TEXT_PRIMARY
    label.TextSize = 16
    label.Font = Enum.Font.GothamSemibold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = contentFrame
    
    local indicator = Instance.new("Frame")
    indicator.Size = UDim2.new(0, 12, 0, 12)
    indicator.Position = UDim2.new(1, -12, 0.5, -6)
    indicator.BackgroundColor3 = COLORS.DANGER
    indicator.BorderSizePixel = 0
    indicator.Parent = contentFrame
    createCorner(indicator, 6)
    
    local originalColor = btn.BackgroundColor3
    
    btn.MouseEnter:Connect(function()
        createTween(btn, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.new(
                math.min(1, originalColor.R + 0.1),
                math.min(1, originalColor.G + 0.1),
                math.min(1, originalColor.B + 0.1)
            )
        })
    end)
    
    btn.MouseLeave:Connect(function()
        createTween(btn, TweenInfo.new(0.2), {BackgroundColor3 = originalColor})
    end)
    
    if callback then
        btn.MouseButton1Click:Connect(function()
            callback()
        end)
    end
    
    return btnFrame, label, indicator, btn
end

local function createModernSlider(parent, text, min, max, current, callback, icon)
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(1, -20, 0, 90)
    sliderFrame.BackgroundColor3 = COLORS.SURFACE
    sliderFrame.BorderSizePixel = 0
    sliderFrame.Parent = parent
    createCorner(sliderFrame, 12)
    createStroke(sliderFrame, COLORS.BORDER)
    createGradient(sliderFrame, COLORS.SURFACE, COLORS.SURFACE_LIGHT)
    
    local padding = Instance.new("UIPadding")
    padding.PaddingAll = UDim.new(0, 20)
    padding.Parent = sliderFrame
    
    local headerFrame = Instance.new("Frame")
    headerFrame.Size = UDim2.new(1, 0, 0, 25)
    headerFrame.BackgroundTransparency = 1
    headerFrame.Parent = sliderFrame
    
    if icon then
        local iconLabel = Instance.new("TextLabel")
        iconLabel.Size = UDim2.new(0, 20, 0, 20)
        iconLabel.Position = UDim2.new(0, 0, 0, 2.5)
        iconLabel.BackgroundTransparency = 1
        iconLabel.Text = icon
        iconLabel.TextColor3 = COLORS.ACCENT
        iconLabel.TextSize = 16
        iconLabel.Font = Enum.Font.GothamBold
        iconLabel.Parent = headerFrame
    end
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, icon and -25 or 0, 1, 0)
    label.Position = UDim2.new(0, icon and 25 or 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text .. ": " .. round(current, 1)
    label.TextColor3 = COLORS.TEXT_PRIMARY
    label.TextSize = 14
    label.Font = Enum.Font.GothamSemibold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = headerFrame
    
    local sliderBg = Instance.new("Frame")
    sliderBg.Size = UDim2.new(1, 0, 0, 8)
    sliderBg.Position = UDim2.new(0, 0, 0, 35)
    sliderBg.BackgroundColor3 = COLORS.BACKGROUND
    sliderBg.BorderSizePixel = 0
    sliderBg.Parent = sliderFrame
    createCorner(sliderBg, 4)
    createStroke(sliderBg, COLORS.BORDER)
    
    local sliderFill = Instance.new("Frame")
    sliderFill.Size = UDim2.new((current - min) / (max - min), 0, 1, 0)
    sliderFill.BackgroundColor3 = COLORS.ACCENT
    sliderFill.BorderSizePixel = 0
    sliderFill.Parent = sliderBg
    createCorner(sliderFill, 4)
    createGradient(sliderFill, COLORS.ACCENT, COLORS.PRIMARY_DARK)
    
    local handle = Instance.new("Frame")
    handle.Size = UDim2.new(0, 20, 0, 20)
    handle.Position = UDim2.new((current - min) / (max - min), -10, 0, -6)
    handle.BackgroundColor3 = COLORS.TEXT_PRIMARY
    handle.BorderSizePixel = 0
    handle.Parent = sliderBg
    createCorner(handle, 10)
    createStroke(handle, COLORS.ACCENT, 2)
    createShadow(handle, 0.3)
    
    local dragging = false
    
    sliderBg.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local pos = math.clamp((Mouse.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
            local value = min + (max - min) * pos
            
            sliderFill.Size = UDim2.new(pos, 0, 1, 0)
            handle.Position = UDim2.new(pos, -10, 0, -6)
            label.Text = text .. ": " .. round(value, 1)
            callback(value)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    return sliderFrame
end

local function createModernColorPicker(parent, text, currentColor, callback, icon)
    local colorFrame = Instance.new("Frame")
    colorFrame.Size = UDim2.new(1, -20, 0, 80)
    colorFrame.BackgroundColor3 = COLORS.SURFACE
    colorFrame.BorderSizePixel = 0
    colorFrame.Parent = parent
    createCorner(colorFrame, 12)
    createStroke(colorFrame, COLORS.BORDER)
    createGradient(colorFrame, COLORS.SURFACE, COLORS.SURFACE_LIGHT)
    
    local padding = Instance.new("UIPadding")
    padding.PaddingAll = UDim.new(0, 15)
    padding.Parent = colorFrame
    
    local headerFrame = Instance.new("Frame")
    headerFrame.Size = UDim2.new(1, 0, 0, 25)
    headerFrame.BackgroundTransparency = 1
    headerFrame.Parent = colorFrame
    
    if icon then
        local iconLabel = Instance.new("TextLabel")
        iconLabel.Size = UDim2.new(0, 20, 0, 20)
        iconLabel.Position = UDim2.new(0, 0, 0, 2.5)
        iconLabel.BackgroundTransparency = 1
        iconLabel.Text = icon
        iconLabel.TextColor3 = COLORS.ACCENT
        iconLabel.TextSize = 16
        iconLabel.Font = Enum.Font.GothamBold
        iconLabel.Parent = headerFrame
    end
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0, 120, 1, 0)
    label.Position = UDim2.new(0, icon and 25 or 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text .. ":"
    label.TextColor3 = COLORS.TEXT_PRIMARY
    label.TextSize = 14
    label.Font = Enum.Font.GothamSemibold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = headerFrame
    
    local colorsData = {
        {Color3.fromRGB(255, 92, 92), "Red"},
        {Color3.fromRGB(92, 255, 92), "Green"},
        {Color3.fromRGB(92, 92, 255), "Blue"},
        {Color3.fromRGB(255, 255, 92), "Yellow"},
        {Color3.fromRGB(255, 92, 255), "Magenta"},
        {Color3.fromRGB(0, 255, 255), "Cyan"},
        {Color3.fromRGB(255, 255, 255), "White"},
        {Color3.fromRGB(50, 50, 50), "Black"}
    }
    
    local colorContainer = Instance.new("Frame")
    colorContainer.Size = UDim2.new(1, -130, 0, 35)
    colorContainer.Position = UDim2.new(0, 130, 0, 25)
    colorContainer.BackgroundTransparency = 1
    colorContainer.Parent = colorFrame
    
    for i, colorData in ipairs(colorsData) do
        local colorBtn = Instance.new("TextButton")
        colorBtn.Size = UDim2.new(0, 32, 0, 32)
        colorBtn.Position = UDim2.new(0, (i-1) * 37, 0, 0)
        colorBtn.BackgroundColor3 = colorData[1]
        colorBtn.Text = ""
        colorBtn.BorderSizePixel = 0
        colorBtn.AutoButtonColor = false
        colorBtn.Parent = colorContainer
        createCorner(colorBtn, 8)
        
        local selected = Instance.new("UIStroke")
        selected.Color = COLORS.ACCENT
        selected.Thickness = 3
        selected.Transparency = currentColor == colorData[1] and 0 or 1
        selected.Parent = colorBtn
        
        colorBtn.MouseEnter:Connect(function()
            createTween(colorBtn, TweenInfo.new(0.2), {Size = UDim2.new(0, 35, 0, 35)})
        end)
        colorBtn.MouseLeave:Connect(function()
            createTween(colorBtn, TweenInfo.new(0.2), {Size = UDim2.new(0, 32, 0, 32)})
        end)
        
        colorBtn.MouseButton1Click:Connect(function()
            for _, child in ipairs(colorContainer:GetChildren()) do
                if child:IsA("TextButton") and child ~= colorBtn then
                    createTween(child.UIStroke, TweenInfo.new(0.2), {Transparency = 1})
                end
            end
            createTween(selected, TweenInfo.new(0.2), {Transparency = 0})
            callback(colorData[1])
        end)
    end
    
    return colorFrame
end

-- Category System
local function closeCategoryFrame()
    if currentCategoryFrame then
        createTween(currentCategoryFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
            Position = UDim2.new(1, 0, 0, 0)
        })
        wait(0.3)
        currentCategoryFrame:Destroy()
        currentCategoryFrame = nil
    end
end

local function createCategoryFrame(name, contentArea)
    closeCategoryFrame()
    
    currentCategoryFrame = Instance.new("ScrollingFrame")
    currentCategoryFrame.Name = name .. "Frame"
    currentCategoryFrame.Size = UDim2.new(1, -40, 1, -40)
    currentCategoryFrame.Position = UDim2.new(1, 0, 0, 20)
    currentCategoryFrame.BackgroundTransparency = 1
    currentCategoryFrame.BorderSizePixel = 0
    currentCategoryFrame.ScrollBarThickness = 8
    currentCategoryFrame.ScrollBarImageColor3 = COLORS.ACCENT
    currentCategoryFrame.ScrollBarImageTransparency = 0.3
    currentCategoryFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    currentCategoryFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    currentCategoryFrame.Parent = contentArea
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 20)
    layout.Parent = currentCategoryFrame
    
    local padding = Instance.new("UIPadding")
    padding.PaddingAll = UDim.new(0, 20)
    padding.Parent = currentCategoryFrame
    
    -- Category header
    local headerFrame = Instance.new("Frame")
    headerFrame.Size = UDim2.new(1, -20, 0, 60)
    headerFrame.BackgroundColor3 = COLORS.SURFACE_LIGHT
    headerFrame.BorderSizePixel = 0
    headerFrame.Parent = currentCategoryFrame
    createCorner(headerFrame, 12)
    createStroke(headerFrame, COLORS.ACCENT, 2)
    createGradient(headerFrame, COLORS.SURFACE_LIGHT, COLORS.SURFACE_HOVER)
    
    local headerPadding = Instance.new("UIPadding")
    headerPadding.PaddingAll = UDim.new(0, 20)
    headerPadding.Parent = headerFrame
    
    local categoryTitle = Instance.new("TextLabel")
    categoryTitle.Size = UDim2.new(1, 0, 1, 0)
    categoryTitle.BackgroundTransparency = 1
    categoryTitle.Text = name .. " Settings"
    categoryTitle.TextColor3 = COLORS.ACCENT
    categoryTitle.TextSize = 22
    categoryTitle.Font = Enum.Font.GothamBold
    categoryTitle.TextXAlignment = Enum.TextXAlignment.Left
    categoryTitle.Parent = headerFrame
    
    -- Slide in animation
    createTween(currentCategoryFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Position = UDim2.new(0, 20, 0, 20)
    })
    
    return currentCategoryFrame
end

local function createCategoryButton(name, callback, icon, contentArea)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 65)
    btn.BackgroundColor3 = COLORS.SURFACE_LIGHT
    btn.Text = ""
    btn.BorderSizePixel = 0
    btn.AutoButtonColor = false
    btn.Parent = Liste
    
    createCorner(btn, 12)
    createStroke(btn, COLORS.BORDER)
    createGradient(btn, COLORS.SURFACE_LIGHT, COLORS.SURFACE_HOVER)
    
    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1, -30, 1, 0)
    contentFrame.Position = UDim2.new(0, 15, 0, 0)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = btn
    
    local iconLabel = Instance.new("TextLabel")
    iconLabel.Size = UDim2.new(0, 35, 0, 35)
    iconLabel.Position = UDim2.new(0, 0, 0, 15)
    iconLabel.BackgroundTransparency = 1
    iconLabel.Text = icon or "⚪"
    iconLabel.TextColor3 = COLORS.ACCENT
    iconLabel.TextSize = 20
    iconLabel.Font = Enum.Font.GothamBold
    iconLabel.Parent = contentFrame
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, -45, 1, 0)
    nameLabel.Position = UDim2.new(0, 45, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = name
    nameLabel.TextColor3 = COLORS.TEXT_PRIMARY
    nameLabel.TextSize = 16
    nameLabel.Font = Enum.Font.GothamSemibold
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Parent = contentFrame
    
    -- Hover effects
    btn.MouseEnter:Connect(function()
        createTween(btn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.PRIMARY})
        createTween(iconLabel, TweenInfo.new(0.2), {TextColor3 = COLORS.TEXT_PRIMARY})
        createTween(nameLabel, TweenInfo.new(0.2), {TextColor3 = COLORS.TEXT_PRIMARY})
    end)
    
    btn.MouseLeave:Connect(function()
        createTween(btn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.SURFACE_LIGHT})
        createTween(iconLabel, TweenInfo.new(0.2), {TextColor3 = COLORS.ACCENT})
        createTween(nameLabel, TweenInfo.new(0.2), {TextColor3 = COLORS.TEXT_PRIMARY})
    end)
    
    btn.MouseButton1Click:Connect(function()
        callback(contentArea)
    end)
end

-- Fly Functions
local function enableFly()
    if flyConnection then return end
    
    local character = LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not rootPart then return end
    
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = rootPart
    
    local bodyAngularVelocity = Instance.new("BodyAngularVelocity")
    bodyAngularVelocity.MaxTorque = Vector3.new(0, math.huge, 0)
    bodyAngularVelocity.AngularVelocity = Vector3.new(0, 0, 0)
    bodyAngularVelocity.Parent = rootPart
    
    flyConnection = RunService.Heartbeat:Connect(function()
        if not rootPart.Parent then
            flyConnection:Disconnect()
            flyConnection = nil
            return
        end
        
        local camera = Workspace.CurrentCamera
        local moveVector = Vector3.new(0, 0, 0)
        
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then
            moveVector = moveVector + camera.CFrame.LookVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then
            moveVector = moveVector - camera.CFrame.LookVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then
            moveVector = moveVector - camera.CFrame.RightVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then
            moveVector = moveVector + camera.CFrame.RightVector
        end
        
        bodyVelocity.Velocity = moveVector * settings.flySpeed
    end)
end

local function disableFly()
    if flyConnection then
        flyConnection:Disconnect()
        flyConnection = nil
    end
    
    local character = LocalPlayer.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            for _, obj in ipairs(rootPart:GetChildren()) do
                if obj:IsA("BodyVelocity") or obj:IsA("BodyAngularVelocity") then
                    obj:Destroy()
                end
            end
        end
    end
end

-- Noclip Functions
local function enableNoclip()
    if noclipConnection then return end
    
    noclipConnection = RunService.Stepped:Connect(function()
        local character = LocalPlayer.Character
        if character then
            for _, part in ipairs(character:GetDescendants()) do
                if part:IsA("BasePart") and part.CanCollide then
                    part.CanCollide = false
                end
            end
        end
    end)
end

local function disableNoclip()
    if noclipConnection then
        noclipConnection:Disconnect()
        noclipConnection = nil
    end
    
    local character = LocalPlayer.Character
    if character then
        for _, part in ipairs(character:GetDescendants()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                part.CanCollide = true
            end
        end
    end
end

-- ESP Functions
local function createHealthBar(player)
    if not player.Character then return end
    
    local character = player.Character
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoidRootPart or not humanoid then return end
    
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Size = UDim2.new(0, 10, 0, 100)
    billboardGui.StudsOffset = Vector3.new(3, 0, 0)
    billboardGui.AlwaysOnTop = true
    billboardGui.LightInfluence = 0
    billboardGui.Parent = humanoidRootPart
    
    local backgroundFrame = Instance.new("Frame")
    backgroundFrame.Size = UDim2.new(1, 0, 1, 0)
    backgroundFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    backgroundFrame.BorderSizePixel = 0
    backgroundFrame.Parent = billboardGui
    createCorner(backgroundFrame, 2)
    
    local healthFrame = Instance.new("Frame")
    healthFrame.Size = UDim2.new(1, 0, humanoid.Health / humanoid.MaxHealth, 0)
    healthFrame.Position = UDim2.new(0, 0, 1 - (humanoid.Health / humanoid.MaxHealth), 0)
    healthFrame.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
    healthFrame.BorderSizePixel = 0
    healthFrame.Parent = backgroundFrame
    createCorner(healthFrame, 2)
    
    local sizeConnection = RunService.Heartbeat:Connect(function()
        if humanoidRootPart.Parent then
            local camera = Workspace.CurrentCamera
            local distance = (camera.CFrame.Position - humanoidRootPart.Position).Magnitude
            local scale = math.max(0.4, math.min(1.2, 40 / distance))
            billboardGui.Size = UDim2.new(0, 10 * scale, 0, 100 * scale)
        end
    end)
    
    local healthConnection = humanoid.HealthChanged:Connect(function(health)
        local healthPercent = health / humanoid.MaxHealth
        healthFrame.Size = UDim2.new(1, 0, healthPercent, 0)
        healthFrame.Position = UDim2.new(0, 0, 1 - healthPercent, 0)
        
        if healthPercent > 0.6 then
            healthFrame.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        elseif healthPercent > 0.3 then
            healthFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 0)
        else
            healthFrame.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        end
    end)
    
    billboardGui.AncestryChanged:Connect(function()
        if not billboardGui.Parent then
            healthConnection:Disconnect()
            sizeConnection:Disconnect()
        end
    end)
    
    return {
        gui = billboardGui,
        sizeConnection = sizeConnection,
        healthConnection = healthConnection
    }
end

local function createHighlight(player)
    if espObjects[player] or not player.Character then return end
    
    local highlight = Instance.new("Highlight")
    highlight.FillColor = settings.espColor
    highlight.OutlineColor = settings.espColor
    highlight.FillTransparency = settings.espTransparency
    highlight.OutlineTransparency = 0
    highlight.Parent = player.Character
    
    local healthBar = createHealthBar(player)
    
    espObjects[player] = {
        highlight = highlight,
        healthBar = healthBar
    }
end

local function removeHighlight(player)
    if espObjects[player] then
        if espObjects[player].highlight then
            espObjects[player].highlight:Destroy()
        end
        if espObjects[player].healthBar then
            if espObjects[player].healthBar.gui then
                espObjects[player].healthBar.gui:Destroy()
            end
            if espObjects[player].healthBar.sizeConnection then
                espObjects[player].healthBar.sizeConnection:Disconnect()
            end
            if espObjects[player].healthBar.healthConnection then
                espObjects[player].healthBar.healthConnection:Disconnect()
            end
        end
        espObjects[player] = nil
    end
end

local function updateESP()
    if settings.espEnabled then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                createHighlight(player)
            end
        end
    else
        for player, objects in pairs(espObjects) do
            removeHighlight(player)
        end
    end
end

-- Nametags Functions
local function createNametag(player)
    if nametagObjects[player] or not player.Character then return end
    
    local character = player.Character
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Size = UDim2.new(0, settings.nametagSize * 8, 0, settings.nametagSize * 2)
    billboardGui.StudsOffset = Vector3.new(0, -3, 0)
    billboardGui.AlwaysOnTop = true
    billboardGui.LightInfluence = 0
    billboardGui.Parent = humanoidRootPart
    
    local nameFrame = Instance.new("Frame")
    nameFrame.Size = UDim2.new(1, 10, 1, 6)
    nameFrame.Position = UDim2.new(0, -5, 0, -3)
    nameFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    nameFrame.BackgroundTransparency = 0.3
    nameFrame.BorderSizePixel = 0
    nameFrame.Parent = billboardGui
    createCorner(nameFrame, 4)
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = player.Name
    textLabel.TextColor3 = settings.nametagColor
    textLabel.TextScaled = true
    textLabel.Font = Enum.Font.GothamBold
    textLabel.TextStrokeTransparency = 0.5
    textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    textLabel.Parent = nameFrame
    
    local sizeConnection = RunService.Heartbeat:Connect(function()
        if humanoidRootPart.Parent then
            local camera = Workspace.CurrentCamera
            local distance = (camera.CFrame.Position - humanoidRootPart.Position).Magnitude
            local scale = math.max(0.6, math.min(2.5, 60 / distance))
            billboardGui.Size = UDim2.new(0, settings.nametagSize * 8 * scale, 0, settings.nametagSize * 2 * scale)
        end
    end)
    
    billboardGui.AncestryChanged:Connect(function()
        if not billboardGui.Parent then
            sizeConnection:Disconnect()
        end
    end)
    
    nametagObjects[player] = {
        gui = billboardGui,
        connection = sizeConnection
    }
end

local function removeNametag(player)
    if nametagObjects[player] then
        if nametagObjects[player].connection then
            nametagObjects[player].connection:Disconnect()
        end
        if nametagObjects[player].gui then
            nametagObjects[player].gui:Destroy()
        end
        nametagObjects[player] = nil
    end
end

local function updateNametags()
    if settings.nametagsEnabled then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                createNametag(player)
            end
        end
    else
        for player, objects in pairs(nametagObjects) do
            removeNametag(player)
        end
    end
end

-- Player Functions
local function getAllPlayers()
    local playerList = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            table.insert(playerList, player)
        end
    end
    return playerList
end

local function teleportToPlayer(targetPlayer)
    if not targetPlayer or not targetPlayer.Character then return end
    
    local character = LocalPlayer.Character
    local targetCharacter = targetPlayer.Character
    
    if character and targetCharacter then
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        local targetRootPart = targetCharacter:FindFirstChild("HumanoidRootPart")
        
        if humanoidRootPart and targetRootPart then
            humanoidRootPart.CFrame = targetRootPart.CFrame + Vector3.new(0, 0, -5)
        end
    end
end

local function viewPlayer(targetPlayer)
    local camera = Workspace.CurrentCamera
    
    if viewingPlayer then
        if viewConnection then
            viewConnection:Disconnect()
            viewConnection = nil
        end
        camera.CameraSubject = LocalPlayer.Character.Humanoid
        viewingPlayer = false
        return false
    else
        if not targetPlayer or not targetPlayer.Character then return false end
        
        camera.CameraSubject = targetPlayer.Character.Humanoid
        viewingPlayer = true
        
        viewConnection = RunService.Heartbeat:Connect(function()
            if not targetPlayer.Character or not targetPlayer.Character.Humanoid then
                viewConnection:Disconnect()
                viewConnection = nil
                camera.CameraSubject = LocalPlayer.Character.Humanoid
                viewingPlayer = false
            end
        end)
        
        return true
    end
end

local function giveAllItems()
    local character = LocalPlayer.Character
    if not character then return end
    
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    if not backpack then return end
    
    for _, obj in ipairs(ReplicatedStorage:GetDescendants()) do
        if obj:IsA("Tool") then
            local hasItem = false
            for _, item in ipairs(backpack:GetChildren()) do
                if item.Name == obj.Name then
                    hasItem = true
                    break
                end
            end
            
            if not hasItem then
                local success, newTool = pcall(function()
                    return obj:Clone()
                end)
                if success then
                    newTool.Parent = backpack
                end
            end
        end
    end
    
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Tool") and obj.Parent ~= character and obj.Parent ~= backpack then
            local hasItem = false
            for _, item in ipairs(backpack:GetChildren()) do
                if item.Name == obj.Name then
                    hasItem = true
                    break
                end
            end
            
            if not hasItem then
                local success, newTool = pcall(function()
                    return obj:Clone()
                end)
                if success then
                    newTool.Parent = backpack
                end
            end
        end
    end
end

-- Category Frames
local function createFlyFrame(contentArea)
    local frame = createCategoryFrame("Flight", contentArea)
    
    local flyFrame, flyLabel, flyIndicator, flyBtn = createModernButton(frame, "Flight Mode", function()
        settings.flyEnabled = not settings.flyEnabled
        
        if settings.flyEnabled then
            flyBtn.BackgroundColor3 = COLORS.SUCCESS
            flyIndicator.BackgroundColor3 = COLORS.SUCCESS
            enableFly()
        else
            flyBtn.BackgroundColor3 = COLORS.SURFACE_LIGHT
            flyIndicator.BackgroundColor3 = COLORS.DANGER
            disableFly()
        end
    end, settings.flyEnabled and "success" or "default", "✈️")
    
    if settings.flyEnabled then
        flyBtn.BackgroundColor3 = COLORS.SUCCESS
        flyIndicator.BackgroundColor3 = COLORS.SUCCESS
        enableFly()
    end
    
    createModernSlider(frame, "Flight Speed", 10, 200, settings.flySpeed, function(value)
        settings.flySpeed = value
    end, "⚡")
    
    -- Controls info
    local infoFrame = Instance.new("Frame")
    infoFrame.Size = UDim2.new(1, -20, 0, 100)
    infoFrame.BackgroundColor3 = COLORS.SURFACE
    infoFrame.BorderSizePixel = 0
    infoFrame.Parent = frame
    createCorner(infoFrame, 12)
    createStroke(infoFrame, COLORS.BORDER)
    createGradient(infoFrame, COLORS.SURFACE, COLORS.SURFACE_LIGHT)
    
    local infoPadding = Instance.new("UIPadding")
    infoPadding.PaddingAll = UDim.new(0, 15)
    infoPadding.Parent = infoFrame
    
    local infoTitle = Instance.new("TextLabel")
    infoTitle.Size = UDim2.new(1, 0, 0, 25)
    infoTitle.BackgroundTransparency = 1
    infoTitle.Text = "🎮 Flight Controls"
    infoTitle.TextColor3 = COLORS.ACCENT
    infoTitle.TextSize = 16
    infoTitle.Font = Enum.Font.GothamBold
    infoTitle.TextXAlignment = Enum.TextXAlignment.Left
    infoTitle.Parent = infoFrame
    
    local controlsText = Instance.new("TextLabel")
    controlsText.Size = UDim2.new(1, 0, 1, -30)
    controlsText.Position = UDim2.new(0, 0, 0, 30)
    controlsText.BackgroundTransparency = 1
    controlsText.Text = "W - Forward • S - Backward\nA - Left • D - Right\nFlight direction follows camera view"
    controlsText.TextColor3 = COLORS.TEXT_SECONDARY
    controlsText.TextSize = 12
    controlsText.Font = Enum.Font.Gotham
    controlsText.TextXAlignment = Enum.TextXAlignment.Left
    controlsText.TextYAlignment = Enum.TextYAlignment.Top
    controlsText.Parent = infoFrame
end

local function createMeFrame(contentArea)
    local frame = createCategoryFrame("Character", contentArea)
    
    createModernButton(frame, "Give All Items", function()
        giveAllItems()
    end, "primary", "🎒")
    
    createModernSlider(frame, "Walk Speed", 16, 100, settings.walkSpeed, function(value)
        settings.walkSpeed = value
        local character = LocalPlayer.Character
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = value
            end
        end
    end, "🏃")
    
    createModernSlider(frame, "Jump Height", 50, 200, settings.jumpHeight, function(value)
        settings.jumpHeight = value
        local character = LocalPlayer.Character
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.JumpPower = value
            end
        end
    end, "⬆️")
    
    local noclipFrame, noclipLabel, noclipIndicator, noclipBtn = createModernButton(frame, "No Clip", function()
        settings.noclipEnabled = not settings.noclipEnabled
        
        if settings.noclipEnabled then
            noclipBtn.BackgroundColor3 = COLORS.SUCCESS
            noclipIndicator.BackgroundColor3 = COLORS.SUCCESS
            enableNoclip()
        else
            noclipBtn.BackgroundColor3 = COLORS.SURFACE_LIGHT
            noclipIndicator.BackgroundColor3 = COLORS.DANGER
            disableNoclip()
        end
    end, settings.noclipEnabled and "success" or "default", "👻")
    
    if settings.noclipEnabled then
        noclipBtn.BackgroundColor3 = COLORS.SUCCESS
        noclipIndicator.BackgroundColor3 = COLORS.SUCCESS
        enableNoclip()
    end
end

local function createPlayerFrame(contentArea)
    local frame = createCategoryFrame("Player", contentArea)
    
    -- Player selection container
    local playerContainer = Instance.new("Frame")
    playerContainer.Size = UDim2.new(1, -20, 0, 220)
    playerContainer.BackgroundColor3 = COLORS.SURFACE
    playerContainer.BorderSizePixel = 0
    playerContainer.Parent = frame
    createCorner(playerContainer, 12)
    createStroke(playerContainer, COLORS.BORDER)
    createGradient(playerContainer, COLORS.SURFACE, COLORS.SURFACE_LIGHT)
    
    local containerPadding = Instance.new("UIPadding")
    containerPadding.PaddingAll = UDim.new(0, 15)
    containerPadding.Parent = playerContainer
    
    -- Header
    local headerFrame = Instance.new("Frame")
    headerFrame.Size = UDim2.new(1, 0, 0, 30)
    headerFrame.BackgroundTransparency = 1
    headerFrame.Parent = playerContainer
    
    local headerTitle = Instance.new("TextLabel")
    headerTitle.Size = UDim2.new(1, 0, 1, 0)
    headerTitle.BackgroundTransparency = 1
    headerTitle.Text = "👥 Player Selection"
    headerTitle.TextColor3 = COLORS.ACCENT
    headerTitle.TextSize = 16
    headerTitle.Font = Enum.Font.GothamBold
    headerTitle.TextXAlignment = Enum.TextXAlignment.Left
    headerTitle.Parent = headerFrame
    
    -- Search bar
    local searchBox = Instance.new("TextBox")
    searchBox.Size = UDim2.new(1, 0, 0, 35)
    searchBox.Position = UDim2.new(0, 0, 0, 40)
    searchBox.BackgroundColor3 = COLORS.BACKGROUND
    searchBox.PlaceholderText = "🔍 Search players..."
    searchBox.Text = ""
    searchBox.TextColor3 = COLORS.TEXT_PRIMARY
    searchBox.PlaceholderColor3 = COLORS.TEXT_MUTED
    searchBox.TextSize = 14
    searchBox.Font = Enum.Font.Gotham
    searchBox.BorderSizePixel = 0
    searchBox.Parent = playerContainer
    createCorner(searchBox, 8)
    createStroke(searchBox, COLORS.BORDER)
    
    local searchPadding = Instance.new("UIPadding")
    searchPadding.PaddingLeft = UDim.new(0, 12)
    searchPadding.Parent = searchBox
    
    -- Player list
    local playerScrollFrame = Instance.new("ScrollingFrame")
    playerScrollFrame.Size = UDim2.new(1, 0, 0, 100)
    playerScrollFrame.Position = UDim2.new(0, 0, 0, 85)
    playerScrollFrame.BackgroundColor3 = COLORS.BACKGROUND
    playerScrollFrame.BorderSizePixel = 0
    playerScrollFrame.ScrollBarThickness = 6
    playerScrollFrame.ScrollBarImageColor3 = COLORS.ACCENT
    playerScrollFrame.ScrollBarImageTransparency = 0.5
    playerScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    playerScrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    playerScrollFrame.Parent = playerContainer
    createCorner(playerScrollFrame, 8)
    createStroke(playerScrollFrame, COLORS.BORDER)
    
    local listLayout = Instance.new("UIListLayout")
    listLayout.Padding = UDim.new(0, 3)
    listLayout.Parent = playerScrollFrame
    
    local listPadding = Instance.new("UIPadding")
    listPadding.PaddingAll = UDim.new(0, 8)
    listPadding.Parent = playerScrollFrame
    
    -- Control buttons
    local buttonFrame = Instance.new("Frame")
    buttonFrame.Size = UDim2.new(1, 0, 0, 40)
    buttonFrame.Position = UDim2.new(0, 0, 0, 195)
    buttonFrame.BackgroundTransparency = 1
    buttonFrame.Parent = playerContainer
    
    local viewBtn = Instance.new("TextButton")
    viewBtn.Size = UDim2.new(0, 130, 0, 40)
    viewBtn.BackgroundColor3 = COLORS.SURFACE_LIGHT
    viewBtn.Text = "👁️ View: OFF"
    viewBtn.TextColor3 = COLORS.TEXT_PRIMARY
    viewBtn.TextSize = 14
    viewBtn.Font = Enum.Font.GothamSemibold
    viewBtn.BorderSizePixel = 0
    viewBtn.AutoButtonColor = false
    viewBtn.Parent = buttonFrame
    createCorner(viewBtn, 8)
    createStroke(viewBtn, COLORS.BORDER)
    createGradient(viewBtn, COLORS.SURFACE_LIGHT, COLORS.SURFACE_HOVER)
    
    local gotoBtn = Instance.new("TextButton")
    gotoBtn.Size = UDim2.new(0, 110, 0, 40)
    gotoBtn.Position = UDim2.new(1, -110, 0, 0)
    gotoBtn.BackgroundColor3 = COLORS.PRIMARY
    gotoBtn.Text = "🚀 Goto"
    gotoBtn.TextColor3 = COLORS.TEXT_PRIMARY
    gotoBtn.TextSize = 14
    gotoBtn.Font = Enum.Font.GothamSemibold
    gotoBtn.BorderSizePixel = 0
    gotoBtn.AutoButtonColor = false
    gotoBtn.Parent = buttonFrame
    createCorner(gotoBtn, 8)
    createGradient(gotoBtn, COLORS.PRIMARY, COLORS.PRIMARY_DARK)
    
    -- Selected player info
    local selectedFrame = Instance.new("Frame")
    selectedFrame.Size = UDim2.new(1, -20, 0, 60)
    selectedFrame.BackgroundColor3 = COLORS.SURFACE
    selectedFrame.BorderSizePixel = 0
    selectedFrame.Parent = frame
    createCorner(selectedFrame, 12)
    createStroke(selectedFrame, COLORS.BORDER)
    createGradient(selectedFrame, COLORS.SURFACE, COLORS.SURFACE_LIGHT)
    
    local selectedPadding = Instance.new("UIPadding")
    selectedPadding.PaddingAll = UDim.new(0, 15)
    selectedPadding.Parent = selectedFrame
    
    local selectedLabel = Instance.new("TextLabel")
    selectedLabel.Size = UDim2.new(1, 0, 1, 0)
    selectedLabel.BackgroundTransparency = 1
    selectedLabel.Text = "🎯 Selected Player: None"
    selectedLabel.TextColor3 = COLORS.TEXT_SECONDARY
    selectedLabel.TextSize = 16
    selectedLabel.Font = Enum.Font.GothamSemibold
    selectedLabel.TextXAlignment = Enum.TextXAlignment.Left
    selectedLabel.Parent = selectedFrame
    
    -- Functions
    local function getSimilarPlayers(input)
        local players = getAllPlayers()
        local similar = {}
        
        for _, player in ipairs(players) do
            local name = player.Name:lower()
            local search = input:lower()
            
            if string.find(name, search, 1, true) then
                table.insert(similar, player)
            end
        end
        
        table.sort(similar, function(a, b)
            local aStarts = string.sub(a.Name:lower(), 1, #input) == input:lower()
            local bStarts = string.sub(b.Name:lower(), 1, #input) == input:lower()
            
            if aStarts and not bStarts then
                return true
            elseif bStarts and not aStarts then
                return false
            else
                return a.Name < b.Name
            end
        end)
        
        return similar
    end
    
    local function updatePlayerList(searchText)
        for _, child in ipairs(playerScrollFrame:GetChildren()) do
            if child:IsA("TextButton") then
                child:Destroy()
            end
        end
        
        local playersToShow = searchText and #searchText > 0 and getSimilarPlayers(searchText) or getAllPlayers()
        
        for _, player in ipairs(playersToShow) do
            local playerBtn = Instance.new("TextButton")
            playerBtn.Size = UDim2.new(1, -12, 0, 28)
            playerBtn.BackgroundColor3 = COLORS.SURFACE_LIGHT
            playerBtn.Text = "👤 " .. player.Name
            playerBtn.TextColor3 = COLORS.TEXT_PRIMARY
            playerBtn.TextSize = 12
            playerBtn.Font = Enum.Font.Gotham
            playerBtn.BorderSizePixel = 0
            playerBtn.AutoButtonColor = false
            playerBtn.Parent = playerScrollFrame
            createCorner(playerBtn, 6)
            
            playerBtn.MouseEnter:Connect(function()
                if settings.selectedPlayer ~= player then
                    createTween(playerBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.PRIMARY})
                end
            end)
            
            playerBtn.MouseLeave:Connect(function()
                if settings.selectedPlayer ~= player then
                    createTween(playerBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.SURFACE_LIGHT})
                end
            end)
            
            playerBtn.MouseButton1Click:Connect(function()
                for _, btn in ipairs(playerScrollFrame:GetChildren()) do
                    if btn:IsA("TextButton") and btn ~= playerBtn then
                        btn.BackgroundColor3 = COLORS.SURFACE_LIGHT
                    end
                end
                
                settings.selectedPlayer = player
                selectedLabel.Text = "🎯 Selected Player: " .. player.Name
                playerBtn.BackgroundColor3 = COLORS.ACCENT
            end)
        end
    end
    
    searchBox:GetPropertyChangedSignal("Text"):Connect(function()
        updatePlayerList(searchBox.Text)
    end)
    
    local function updateViewButton(viewing)
        if viewing then
            viewBtn.Text = "👁️ View: ON"
            viewBtn.BackgroundColor3 = COLORS.SUCCESS
        else
            viewBtn.Text = "👁️ View: OFF"
            viewBtn.BackgroundColor3 = COLORS.SURFACE_LIGHT
        end
    end
    
    viewBtn.MouseButton1Click:Connect(function()
        if settings.selectedPlayer then
            local viewing = viewPlayer(settings.selectedPlayer)
            updateViewButton(viewing)
        end
    end)
    
    gotoBtn.MouseButton1Click:Connect(function()
        if settings.selectedPlayer then
            teleportToPlayer(settings.selectedPlayer)
        end
    end)
    
    -- Button hover effects
    viewBtn.MouseEnter:Connect(function()
        if viewBtn.BackgroundColor3 ~= COLORS.SUCCESS then
            createTween(viewBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.SURFACE_HOVER})
        end
    end)
    
    viewBtn.MouseLeave:Connect(function()
        if viewBtn.Text == "👁️ View: OFF" then
            createTween(viewBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.SURFACE_LIGHT})
        end
    end)
    
    gotoBtn.MouseEnter:Connect(function()
        createTween(gotoBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.PRIMARY_DARK})
    end)
    
    gotoBtn.MouseLeave:Connect(function()
        createTween(gotoBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLORS.PRIMARY})
    end)
    
    -- Event handlers
    local function onPlayerAdded()
        wait(0.1)
        updatePlayerList(searchBox.Text)
    end
    
    local function onPlayerRemoving(player)
        if settings.selectedPlayer == player then
            settings.selectedPlayer = nil
            selectedLabel.Text = "🎯 Selected Player: None"
            updateViewButton(false)
        end
        updatePlayerList(searchBox.Text)
    end
    
    Players.PlayerAdded:Connect(onPlayerAdded)
    Players.PlayerRemoving:Connect(onPlayerRemoving)
    
    updatePlayerList()
end

local function createESPFrame(contentArea)
    local frame = createCategoryFrame("ESP", contentArea)
    
    local espFrame, espLabel, espIndicator, espBtn = createModernButton(frame, "ESP Highlight", function()
        settings.espEnabled = not settings.espEnabled
        
        if settings.espEnabled then
            espBtn.BackgroundColor3 = COLORS.SUCCESS
            espIndicator.BackgroundColor3 = COLORS.SUCCESS
        else
            espBtn.BackgroundColor3 = COLORS.SURFACE_LIGHT
            espIndicator.BackgroundColor3 = COLORS.DANGER
        end
        
        updateESP()
    end, settings.espEnabled and "success" or "default", "👁️")
    
    if settings.espEnabled then
        espBtn.BackgroundColor3 = COLORS.SUCCESS
        espIndicator.BackgroundColor3 = COLORS.SUCCESS
        updateESP()
    end
    
    createModernColorPicker(frame, "Highlight Color", settings.espColor, function(color)
        settings.espColor = color
        for player, objects in pairs(espObjects) do
            if objects.highlight then
                objects.highlight.FillColor = color
                objects.highlight.OutlineColor = color
            end
        end
    end, "🎨")
    
    createModernSlider(frame, "Highlight Transparency", 0, 1, settings.espTransparency, function(value)
        settings.espTransparency = value
        for player, objects in pairs(espObjects) do
            if objects.highlight then
                objects.highlight.FillTransparency = value
            end
        end
    end, "👻")
    
    local nametagFrame, nametagLabel, nametagIndicator, nametagBtn = createModernButton(frame, "Player Nametags", function()
        settings.nametagsEnabled = not settings.nametagsEnabled
        
        if settings.nametagsEnabled then
            nametagBtn.BackgroundColor3 = COLORS.SUCCESS
            nametagIndicator.BackgroundColor3 = COLORS.SUCCESS
        else
            nametagBtn.BackgroundColor3 = COLORS.SURFACE_LIGHT
            nametagIndicator.BackgroundColor3 = COLORS.DANGER
        end
        
        updateNametags()
    end, settings.nametagsEnabled and "success" or "default", "🏷️")
    
    if settings.nametagsEnabled then
        nametagBtn.BackgroundColor3 = COLORS.SUCCESS
        nametagIndicator.BackgroundColor3 = COLORS.SUCCESS
        updateNametags()
    end
    
    createModernColorPicker(frame, "Nametag Color", settings.nametagColor, function(color)
        settings.nametagColor = color
        for player, objects in pairs(nametagObjects) do
            if objects.gui and objects.gui:FindFirstChild("Frame") and objects.gui.Frame:FindFirstChild("TextLabel") then
                objects.gui.Frame.TextLabel.TextColor3 = color
            end
        end
    end, "🎨")
    
    createModernSlider(frame, "Nametag Size", 5, 50, settings.nametagSize, function(value)
        settings.nametagSize = value
        for player, objects in pairs(nametagObjects) do
            if objects.gui then
                local camera = Workspace.CurrentCamera
                local humanoidRootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                if camera and humanoidRootPart then
                    local distance = (camera.CFrame.Position - humanoidRootPart.Position).Magnitude
                    local scale = math.max(0.6, math.min(2.5, 60 / distance))
                    objects.gui.Size = UDim2.new(0, value * 8 * scale, 0, value * 2 * scale)
                end
            end
        end
    end, "📏")
end

-- Initialize Categories
local function initializeCategories(contentArea)
    createCategoryButton("Flight", function() createFlyFrame(contentArea) end, "✈️", contentArea)
    createCategoryButton("Character", function() createMeFrame(contentArea) end, "👤", contentArea)
    createCategoryButton("Players", function() createPlayerFrame(contentArea) end, "👥", contentArea)
    createCategoryButton("ESP", function() createESPFrame(contentArea) end, "👁️", contentArea)
end

-- Event Handlers
local function onCharacterAdded(character)
    local humanoid = character:WaitForChild("Humanoid")
    humanoid.WalkSpeed = settings.walkSpeed
    humanoid.JumpPower = settings.jumpHeight
    
    if settings.flyEnabled then
        wait(1)
        enableFly()
    end
    
    if settings.noclipEnabled then
        enableNoclip()
    end
end

-- Player Events
Players.PlayerAdded:Connect(function(player)
    if settings.espEnabled and player ~= LocalPlayer then
        player.CharacterAdded:Connect(function()
            wait(0.5)
            createHighlight(player)
        end)
    end
    
    if settings.nametagsEnabled and player ~= LocalPlayer then
        player.CharacterAdded:Connect(function()
            wait(0.5)
            createNametag(player)
        end)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    removeHighlight(player)
    removeNametag(player)
end)

-- Character Respawn
if LocalPlayer.Character then
    onCharacterAdded(LocalPlayer.Character)
end

LocalPlayer.CharacterAdded:Connect(onCharacterAdded)

-- Menu Toggle
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == settings.menuKey then
        if VyrxisGui then
            VyrxisGui.Enabled = not VyrxisGui.Enabled
            
-- Menu Toggle
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == settings.menuKey then
        if VyrxisGui then
            VyrxisGui.Enabled = not VyrxisGui.Enabled
            
            if VyrxisGui.Enabled then
                createTween(MainRahmen, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                    Position = UDim2.new(0.5, -450, 0.5, -300)
                })
            end
        end
    end
end)

-- Cleanup on disconnect
game.Players.PlayerRemoving:Connect(function(player)
    if player == LocalPlayer then
        disableFly()
        disableNoclip()
        for p, objects in pairs(espObjects) do
            removeHighlight(p)
        end
        for p, objects in pairs(nametagObjects) do
            removeNametag(p)
        end
    end
end)

-- Initialize System
spawn(function()
    createLoadScreen()
    wait(5.5)
    local contentArea = createMainUI()
    createSettingsFrame()
    initializeCategories(contentArea)
    
    -- Show welcome animation
    createTween(MainRahmen, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Position = UDim2.new(0.5, -450, 0.5, -300)
    })
end)
